<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <title>Mandelbrot GPU</title>


    <script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

    in vec4 vPosition;

    out vec4 vertex_pos;

    void
    main()
    {
        gl_Position = vPosition;
        gl_PointSize = 1.0;
        vertex_pos = vPosition;
    }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es
    precision highp float;

    in vec4 vertex_pos;

    uniform vec2 complex_mapping_st;
    uniform vec2 complex_mapping_end;
    uniform int n_t;
    uniform float escape_time;

    out vec4 fragColor;

    void
    main()
    {
        float c_re = vertex_pos[0] * 2.0;
        float c_im = vertex_pos[1] * 2.0;

        float new_c_re;
        float new_c_im;

        fragColor = vec4(0, 0, 1, 1);

        float current_num_re = c_re;
        float current_num_im = c_im;
        
        for(int n = 1; n <= n_t; n++)
        {
          float mag = pow(pow(current_num_re, 2.0) + pow(current_num_im, 2.0), 0.5);
          if (mag > escape_time)
          {
            if (n == 1)
            {
              fragColor = vec4(1, 0, 0, 1);
            }
            else
            {
              if (n < (n_t/2))
              {
                  float red = abs((float(n) / float(n_t)) - 1.0);
                  float green = float(n) / float(n_t);

                  fragColor = vec4(red, green, 0, 1);
              }

              else if (n >= (n_t/2))
              {
                  float green = abs((float(n) / float(n_t)) - 1.0);
                  float blue = float(n) / float(n_t);

                  fragColor = vec4(0, green, blue, 1);
              }
            }

            break;
          }

          new_c_re = pow(current_num_re, 2.0) - pow(current_num_im, 2.0);
          new_c_im = 2.0 * current_num_re * current_num_im;

          current_num_re = new_c_re + c_re;
          current_num_im = new_c_im + c_im;
        }
        
    }
    </script>


    <script src="http://interactivecomputergraphics.com/8E/Code%20update/Common/initShadersES6.js"></script>
    <script src="http://interactivecomputergraphics.com/8E/Code%20update/Common/MVES6.js"></script>
    <script type="text/javascript" src="helpers.js"></script>
    <script src="https://unpkg.com/mathjs@9.5.0/lib/browser/math.js"></script>
    <script type="text/javascript" src="mandelbrot-gpu.js"></script>
  </head>

  
  <body>
    <h1>Mandelbrot GPU</h1>
    
    <canvas id="gl-canvas" width="512" height="512">
      Oops ... your browser doesn't support the HTML5 canvas element
    </canvas>
  </body>
</html>
